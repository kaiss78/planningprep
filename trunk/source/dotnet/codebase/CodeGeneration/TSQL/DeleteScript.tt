<#@ include file="../Globals/GlobalSettings.tt" #>
<#	
	
	// Do not change for this script
	string TableSuffix = "Delete";	
	
	InitDB();

	WriteLine(string.Format("IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[sp{0}{1}]') AND type in (N'P', N'PC'))", FormattedBaseTableName,TableSuffix));
	WriteLine(string.Format("DROP PROCEDURE [dbo].[sp{0}{1}]", FormattedBaseTableName,TableSuffix));
	WriteLine("GO");
	WriteLine(string.Format("CREATE PROCEDURE [dbo].[sp{0}{1}] ", FormattedBaseTableName,TableSuffix));
	WriteOutProcParameters(Base_Table);
	PopIndent();
	WriteLine("AS");
	StoredProcedureComments(Base_Table.Name, TableSuffix);
	WriteLine("BEGIN");
	PushIndent("\t");
	BaseTableDelete(Base_Table);
	PopIndent();
	WriteLine("END");
	WriteLine("GO");
#>

<#+ 

	public string GetPrimaryKeyName(Table table)
	{
		foreach( Column col in table.Columns )
		{
			if(col.InPrimaryKey)
			{
				return col.Name;
			}
		}
		return string.Empty;
	}
	
	public void WriteOutProcParameters(Table table)
	{
		foreach( Column col in table.Columns )
		{
			if(col.InPrimaryKey)
			{
				WriteLine("@{0} {1}", "Id", GetDataTypeDeclaration(col.DataType));
				break;
			}
		}
	}
	
	public void BaseTableDelete(Table table)
	{
		PushIndent("\t");
		WriteLine("");
		WriteLine("DELETE FROM " + table.Name);		
		WriteLine("WHERE [" + GetPrimaryKeyName(table) + "]=@Id");
		WriteLine("");
		PopIndent();
	}
	
	public void SetWhereColumns(Table prmTable)
	{
		PopIndent();
		bool firstcol = true;
		
		foreach( Column column in prmTable.Columns )
		{
			if (column.Name =="Id")
			{
				WriteLine("{0}[{2}]= @{1}",firstcol?" Where ":", ", column.Name,column.Name );
				firstcol=false;
			}
		}
	}
 #>